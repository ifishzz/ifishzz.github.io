<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		
		<meta name="author" content="ifish">
		
		<meta name="generator" content="Hugo 0.54.0" />
		<title>中间件漏洞 &middot; if1sh</title>
		<link rel="shortcut icon" href="https://ifishzz.github.io//images/favicon.ico">
		<link rel="stylesheet" href="https://ifishzz.github.io//css/style.css">
		<link rel="stylesheet" href="https://ifishzz.github.io//css/highlight.css">

		
		<link rel="stylesheet" href="https://ifishzz.github.io//css/font-awesome.min.css">
		

		

		
	</head>

    <body>
       <nav class="main-nav">
	
	
		<a href='https://ifishzz.github.io/'> <span class="arrow">←</span>Home</a>
	
	<a href='https://ifishzz.github.io//posts'>Archive</a>
	
	<a href='https://ifishzz.github.io//categories'>Cate</a>
	<a href='https://ifishzz.github.io//links'>Link</a>

	<a href='https://ifishzz.github.io//about'>About</a>

	

	
	<a class="cta" href="https://ifishzz.github.io/index.xml">Subscribe</a>
	
</nav>


        <section id="wrapper" class="post">
            <article>
                <header>
                    <h1>
                        中间件漏洞
                    </h1>
                    <h2 class="headline">
                    Mar 5, 2019 00:00
                    · 1718 words
                    · 4 minute read
                      <span class="tags">
                      
                      
                          
                              <a href="https://ifishzz.github.io//tags/%E4%B8%AD%E9%97%B4%E4%BB%B6">中间件</a>
                          
                      
                      
                      </span>
                    </h2>
                </header>
                
                  
                    <div id="toc">
                      <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#0x00-中间件">0x00 中间件</a></li>
<li><a href="#tomcat">Tomcat</a></li>
<li><a href="#jboss">jBoss</a></li>
</ul></li>
</ul>
</nav>
                    </div>
                  
                
                <section id="post-body">
                    

<h2 id="0x00-中间件">0x00 中间件</h2>

<p><strong>web服务器</strong></p>

<p>web服务器用于提供http服务，即向客户端返回信息，其可以处理HTTP协议，响应针对静态页面或图片的请求，控制页面跳转，或者把动态请求委托其它程序（中间件程序）等。</p>

<p><strong>web中间件</strong></p>

<p>web中间件用于提供系统软件和应用软件之间的连接，以便于软件各部件之间的沟通，其可以为一种或多种应用程序提供容器。</p>

<p><strong>web容器</strong></p>

<p>web容器用于给处于其中的应用程序组件（JSP，SERVLET）提供一个环境，是中间件的一个组成部分，它实现了对动态语言的解析。比如tomcat可以解析jsp，是因为其内部有一个jsp容器。</p>

<p><strong>所属的类别</strong></p>

<p>web服务器：IIS、Apache、nginx、tomcat、weblogic、websphere等。</p>

<p>web中间件：apache tomcat、BEA WebLogic、IBM WebSphere等。</p>

<p>web容器：JSP容器、SERVLET容器、ASP容器等。</p>

<p>注意：web中间件与web服务器是有重叠的，原因在于tomcat等web中间件也具备web服务器的功能。</p>

<p><strong>重点分析</strong></p>

<p>web服务器只是提供静态网页解析（如apache），或者提供跳转的这么一种服务。而web中间件（其包含web容器）可以解析动态语言，比如tomcat可以解析jsp（因为tomcat含有jsp容器），当然它也可以解析静态资源，因此它既是web中间件也是web服务器。不过tomcat解析静态资源的速度不如apache，因此常常两者结合使用。</p>

<h2 id="tomcat">Tomcat</h2>

<p>tomcat是apache的一个中间件软件，其可以提供jsp或者php的解析服务，为了方便远程管理与部署，安装完tomcat以后默认会有一个管理页面，管理员只需要远程上传一个WAR格式的文件，便可以将内容发布到网站，这一功能方便了管理员的同时也给黑客打开了方便之门，除此之外，tomcat还有一些样本页面，如果处理不当也会导致安全问题。</p>

<p>tomcat管理地址通常是：</p>

<p><a href="Http://localhost:8080/manager">Http://localhost:8080/manager</a></p>

<p>默认账号密码：</p>

<pre><code>root/root
tomcat/tomcat 
admin admin
admin 123456
</code></pre>

<p><strong>tomcat口令爆破</strong></p>

<p>在默认不对tomcat做任何配置的时候爆破是无效的，而如果设置了账号密码就可以进行爆破。Tomcat的认证比较弱，Base64(用户名:密码)编码，请求响应码如果不是401（未经授权：访问由于凭据无效被拒绝。）即表示登录成功。登录成功后，可直接上传war文件，getshell（当然上传war文件需要manager权限）</p>

<p><strong>war漏洞</strong></p>

<p>.jsp shell文件打包为war文件：</p>

<pre><code>jar -cvf shell.war shell.jsp
</code></pre>

<p>进入后台war file to deploy上传</p>

<p><strong>漏洞修复</strong>
- 删除远程部署页面，或者限定页面的访问权限。
- 找到/conf/tomcat-users.xml修改用户名密码以及权限。</p>

<h2 id="jboss">jBoss</h2>

<p>jBoss是一个基于J2EE的开发源代码的应用服务器。 JBoss是一个管理EJB的容器和服务器，支持EJB1.1、EJB 2.0和EJB3的规范。但JBoss核心服务不包括支持servlet/JSP的WEB容器，一般与Tomcat或Jetty绑定使用。与tomcat类似的是jboss也有远程部署平台，但不需要登陆。漏洞利用过程与tomcat类似</p>

<p>默认管理后台地址：</p>

<p><a href="http://localhost:8080">http://localhost:8080</a></p>

<p><strong>war漏洞</strong>
访问管理页面，查看jboss配置页面中的JMX Console，这是JBoss的管理台程序，进入后找到Jboss.deployment包，该包下有flavor=URL.type=DeploymentSccanner选项。进入部署页面后便可以上传war文件，但与tomcat不同的是它不是本地上传war文件，而是从远程地址下载，因此需要自己准备一个文件服务器，用于远程下载war到目标jboss服务器上。具体方法是在部署页面找到”ADDURL”方法，输入URL地址，点击invoke。除了以上方法外，JMX-Console提供的BSH方法，同样也可以部署war包。</p>

<p><strong>漏洞修复</strong>
开启jmx-console密码认证</p>

<p>删除jmx-console.war与web-console.war</p>

<p><strong>反序列化漏洞</strong></p>

<p><a href="http://localhost:8080/invoker/readonly">http://localhost:8080/invoker/readonly</a></p>

<p>返回500，说明页面存在，此页面有反序列化漏洞</p>

<p><strong>漏洞修复</strong></p>

<p>有效解决方案：升级到JBOSS AS7版本</p>

<p>临时解决方案：</p>

<p>1）不需要http-invoker.sar 组件的用户可直接删除此组件；</p>

<p>2）用于对 httpinvoker 组件进行访问控制。</p>

                </section>
            </article>

            
                

            

            

            

            <footer id="footer">
    
    
    <p class="small">
        Powered by <a href="http://www.gohugo.io/">Hugo</a> Theme By <a href="https://github.com/ifishzz">ifish</a>
    </p>
</footer>

        </section>

        <script src="https://ifishzz.github.io//js/jquery-3.3.1.min.js"></script>
<script src="https://ifishzz.github.io//js/main.js"></script>
<script src="https://ifishzz.github.io//js/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>




  



<script>
var baiduAnalytics = '';
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?" + baiduAnalytics;
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
</script>


    </body>
</html>
